<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Family Tree</title>
<style>
.circle-tree {
    position: relative;
    width: 750px;
    height: 750px;
    margin: auto;
}
.node {
    position: absolute;
    width: 110px;
    text-align: center;
    transform: translate(-50%, -50%);
    border: 1px solid #000;
    padding: 10px;
    border-radius: 10px;
    background: #fff;
    z-index: 9;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
.node img {
    width: 65px;
    border-radius: 50%;
    border: 2px solid #4CAF50;
    padding: 4px;
    background: white;
}
.name { font-weight: bold; margin-top: 6px; font-size: 14px; }
.btn { display: inline-block; margin-top: 4px; padding: 4px 10px; font-size: 12px; background: #002b80; color: white; border-radius: 5px; text-decoration: none; }
.center { top: 50%; left: 50%; }
.line { position: absolute; height: 2px; background: #999; top: 50%; left: 50%; transform-origin: left center; }
.line .label { position: absolute; left: 50%; top: -22px; font-size: 13px; color: #333; white-space: nowrap; }
.wife-label { top: 8px !important; transform: rotate(180deg) !important; }
.text-h1 { text-align: center; }
.plus-icon {
    position: absolute;
    top: -9px;
    left: 45%;
    width: 15px;
    height: 15px;
    background: #000;
    color: #fff;
    font-size: 14px;
    font-weight: bold;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
.children-container { display: none; position: relative; margin-top: 10px; }
</style>
</head>
<body>
<h1 class="text-h1">Family Tree</h1>

<div class="circle-tree">

    <!-- Center Node -->
    <div class="node center" data-id="{{ $member->id }}">
        @if($member->children->count() > 0)
            <div class="plus-icon">+</div>
        @endif
        <img src="{{ asset('uploads/'.$member->image) }}" alt="{{ $member->name }}">
        <div class="name">{{ $member->name }}</div>
        <a href="#" class="btn">VIEW</a>
    </div>

    <!-- Mother -->
    @if($mother)
        <div class="line" style="width:270px; transform: rotate(-120deg);">
            <span class="label">Mother</span>
        </div>
        <div class="node" style="top: calc(50% - 280px); left: calc(50% - 170px);" data-id="{{ $mother->id }}">
            @if($mother->children->count() > 0)
                <div class="plus-icon">+</div>
            @endif
            <img src="{{ asset('uploads/'.$mother->image) }}" alt="{{ $mother->name }}">
            <div class="name">{{ $mother->name }}</div>
            <a href="#" class="btn">VIEW</a>
        </div>
    @endif

    <!-- Father -->
    @if($father)
        <div class="line" style="width:270px; transform: rotate(-60deg);">
            <span class="label">Father</span>
        </div>
        <div class="node" style="top: calc(50% - 280px); left: calc(50% + 170px);" data-id="{{ $father->id }}">
            @if($father->children->count() > 0)
                <div class="plus-icon">+</div>
            @endif
            <img src="{{ asset('uploads/'.$father->image) }}" alt="{{ $father->name }}">
            <div class="name">{{ $father->name }}</div>
            <a href="#" class="btn">VIEW</a>
        </div>
    @endif

    <!-- Wife -->
    @if($wife)
        <div class="line" style="width:300px; transform: rotate(180deg);">
            <span class="label wife-label">Wife</span>
        </div>
        <div class="node" style="top: 50%; left: calc(50% - 300px);" data-id="{{ $wife->id }}">
            @if($wife->children->count() > 0)
                <div class="plus-icon">+</div>
            @endif
            <img src="{{ asset('uploads/'.$wife->image) }}" alt="{{ $wife->name }}">
            <div class="name">{{ $wife->name }}</div>
            <a href="#" class="btn">VIEW</a>
        </div>
    @endif

    <!-- Children -->
    @foreach($children as $child)
        @php
            $angle = $loop->index % 2 == 0 ? 120 : 60;
            $x = $loop->index == 0 ? '-170px' : '170px';
        @endphp
        <div class="line" style="width:270px; transform: rotate({{ $angle }}deg);">
            <span class="label">{{ $child->name }}</span>
        </div>
        <div class="node" style="top: calc(50% + 280px); left: calc(50% + {{ $x }});" data-id="{{ $child->id }}">
            @if($child->children->count() > 0)
                <div class="plus-icon">+</div>
                <div class="children-container">
                    @foreach($child->children as $grand)
                        <div class="node" style="top: calc(50% + 60px); left: calc(50% + 0px);">
                            <img src="{{ asset('uploads/'.$grand->image) }}" alt="{{ $grand->name }}">
                            <div class="name">{{ $grand->name }}</div>
                        </div>
                    @endforeach
                </div>
            @endif
            <img src="{{ asset('uploads/'.$child->image) }}" alt="{{ $child->name }}">
            <div class="name">{{ $child->name }}</div>
            <a href="#" class="btn">VIEW</a>
        </div>
    @endforeach
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.plus-icon').forEach(icon => {
        icon.addEventListener('click', function(e) {
            e.stopPropagation();
            let node = icon.closest('.node');
            let children = node.querySelector('.children-container');
            if(children){
                if(children.style.display === 'none' || children.style.display === ''){
                    children.style.display = 'block';
                    icon.textContent = '-';
                } else {
                    children.style.display = 'none';
                    icon.textContent = '+';
                }
            }
        });
    });
});
</script>

</body>
</html>
